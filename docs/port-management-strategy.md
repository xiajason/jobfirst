# JobFirst 端口管理策略

## 📋 端口分配原则

### 1. 端口段划分
- **8000-8099**: JobFirst核心服务
- **8100-8199**: JobFirst扩展服务
- **8200-8299**: 基础设施服务
- **8300-8399**: 监控和运维服务
- **8400-8499**: 开发和测试服务

### 2. 环境区分
- **开发环境**: 使用8000-8499端口段
- **生产环境**: 使用9000-9499端口段
- **测试环境**: 使用9500-9999端口段

## 🏗️ 当前实际端口分配

### JobFirst核心服务 (8000-8099)

| 服务名称 | 端口 | 内部端口 | 状态 | 说明 |
|----------|------|----------|------|------|
| **API网关** | 8080 | 8080 | ⚠️ 无响应 | 统一入口 |
| **用户服务** | 8081 | 8081 | ⚠️ 无响应 | 用户管理 |
| **简历服务** | 8087 | 8082 | ⚠️ 无响应 | 简历管理 |
| **积分服务** | 8086 | 8083 | ⚠️ 无响应 | 积分系统 |
| **统计服务** | 8097 | 8085 | ⚠️ 无响应 | 数据统计 |
| **存储服务** | 8088 | 8088 | ❌ 未启动 | 文件存储 |
| **前端Web** | 3000 | 3000 | ❌ 未启动 | Next.js应用 |

### 原有系统服务 (6000-6999, 8000-8999, 9000-9999)

| 服务名称 | 端口 | 状态 | 说明 |
|----------|------|------|------|
| **个人端服务** | 6001 | ✅ 运行中 | 个人用户服务 |
| **管理端服务** | 8003 | ✅ 运行中 | 管理后台服务 |
| **企业端服务** | 8002 | ⚠️ 无响应 | 企业用户服务 |
| **资源服务** | 9002 | ✅ 运行中 | 资源管理服务 |
| **开放API服务** | 9006 | ✅ 运行中 | 开放API服务 |

### 基础设施服务 (8200-8299)

| 服务名称 | 端口 | 内部端口 | 状态 | 说明 |
|----------|------|----------|------|------|
| **MySQL数据库** | 8200 | 3306 | ✅ 运行中 | 主数据库 |
| **Redis缓存** | 8201 | 6379 | ✅ 运行中 | 缓存服务 |
| **Consul服务发现** | 8202 | 8500 | ✅ 运行中 | 服务注册发现 |
| **Neo4j图数据库** | 8203 | 7474 | ✅ 运行中 | 图数据库HTTP |
| **Neo4j Bolt** | 8204 | 7687 | ✅ 运行中 | 图数据库Bolt |

### 监控运维服务 (8300-8399)

| 服务名称 | 端口 | 内部端口 | 说明 |
|----------|------|----------|------|
| **Prometheus** | 8300 | 9090 | 监控指标 |
| **Grafana** | 8301 | 3000 | 监控面板 |
| **Kibana** | 8302 | 5601 | 日志分析 |
| **Elasticsearch** | 8303 | 9200 | 搜索引擎 |

### 第三方集成 (8400-8499)

| 服务名称 | 端口 | 内部端口 | 说明 |
|----------|------|----------|------|
| **Kong API网关** | 8400 | 8000 | API网关 |
| **Kong Admin** | 8401 | 8001 | 网关管理 |
| **Kong Status** | 8402 | 8002 | 网关状态 |

## 🔧 当前系统状态分析

### ✅ 正常运行的服务
1. **基础设施服务**: MySQL(8200), Redis(8201), Consul(8202), Neo4j(8203,8204)
2. **原有系统服务**: 个人端(6001), 管理端(8003), 资源(9002), 开放API(9006)

### ⚠️ 需要关注的服务
1. **核心微服务**: 大部分核心服务处于无响应状态
2. **前端服务**: Web前端未启动
3. **存储服务**: 文件存储服务未启动

### 🔧 建议的优化方案

#### 1. 统一端口分配
```
核心服务: 8000-8099
- 网关: 8000
- 用户: 8001
- 简历: 8002
- 积分: 8003
- 统计: 8004
- 存储: 8005
- Web前端: 8006

原有系统: 6000-6999
- 个人端: 6001
- 管理端: 6002
- 企业端: 6003

基础设施: 8200-8299
- MySQL: 8200
- Redis: 8201
- Consul: 8202
- Neo4j: 8203,8204
```

#### 2. 服务健康检查
```bash
# 检查服务状态
./scripts/dev-start.sh status

# 重启无响应的服务
./scripts/dev-start.sh restart gateway
./scripts/dev-start.sh restart user
./scripts/dev-start.sh restart resume
./scripts/dev-start.sh restart points
./scripts/dev-start.sh restart statistics
./scripts/dev-start.sh restart storage
```

## 📊 端口冲突检查

### 检查脚本
```bash
#!/bin/bash
# scripts/check-ports.sh

echo "🔍 检查端口占用情况..."

# 检查JobFirst核心服务端口
JOBFIRST_CORE_PORTS=(8000 8001 8002 8003 8004 8005 8006 8007)
for port in "${JOBFIRST_CORE_PORTS[@]}"; do
    if lsof -Pi :$port -sTCP:LISTEN -t >/dev/null 2>&1; then
        echo "⚠️  端口 $port 已被占用"
        lsof -i :$port
    else
        echo "✅ 端口 $port 可用"
    fi
done

# 检查原有系统端口
LEGACY_PORTS=(6001 8002 8003 9002 9006)
for port in "${LEGACY_PORTS[@]}"; do
    if lsof -Pi :$port -sTCP:LISTEN -t >/dev/null 2>&1; then
        echo "✅ 端口 $port 正在使用"
        lsof -i :$port
    else
        echo "❌ 端口 $port 未使用"
    fi
done

# 检查基础设施端口
INFRA_PORTS=(8200 8201 8202 8203 8204 8205)
for port in "${INFRA_PORTS[@]}"; do
    if lsof -Pi :$port -sTCP:LISTEN -t >/dev/null 2>&1; then
        echo "✅ 端口 $port 正在使用"
        lsof -i :$port
    else
        echo "❌ 端口 $port 未使用"
    fi
done
```

## 🎯 迁移计划

### 阶段一：服务恢复
1. **重启无响应的核心服务**
2. **启动未运行的服务**
3. **验证服务健康状态**

### 阶段二：端口优化
1. **统一端口分配**
2. **更新配置文件**
3. **测试服务间通信**

### 阶段三：监控完善
1. **添加健康检查**
2. **配置监控告警**
3. **完善日志管理**

## 📋 当前访问地址

### 正常运行的服务
- **个人端服务**: http://localhost:6001
- **管理端服务**: http://localhost:8003
- **资源服务**: http://localhost:9002
- **开放API服务**: http://localhost:9006
- **Consul管理界面**: http://localhost:8202
- **Neo4j浏览器**: http://localhost:8203
- **MySQL数据库**: localhost:8200
- **Redis缓存**: localhost:8201

### 需要恢复的服务
- **API网关**: http://localhost:8080 (无响应)
- **用户服务**: http://localhost:8081 (无响应)
- **简历服务**: http://localhost:8087 (无响应)
- **积分服务**: http://localhost:8086 (无响应)
- **统计服务**: http://localhost:8097 (无响应)
- **存储服务**: http://localhost:8088 (未启动)
- **前端Web应用**: http://localhost:3000 (未启动)

## 🎯 总结

当前JobFirst系统的端口管理状况：

1. **基础设施稳定**: 数据库、缓存、服务发现等基础设施服务运行正常
2. **原有系统可用**: 个人端、管理端、资源等原有系统服务正常运行
3. **核心服务待恢复**: 大部分核心微服务需要重启和优化
4. **端口分配合理**: 当前端口分配基本合理，但需要统一管理

**建议优先行动**:
1. 重启无响应的核心服务
2. 统一端口分配策略
3. 完善服务监控和健康检查
4. 建立标准化的部署流程
