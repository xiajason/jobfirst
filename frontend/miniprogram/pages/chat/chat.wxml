<!--chat.wxml-->
<view class="container">
  <!-- 聊天列表 -->
  <view class="chat-list" wx:if="{{chatList.length > 0}}">
    <view 
      class="chat-item" 
      wx:for="{{chatList}}" 
      wx:key="id"
      bindtap="navigateToChatDetail"
      data-chat="{{item}}"
    >
      <view class="chat-avatar">
        <image 
          class="avatar" 
          src="{{item.avatar}}" 
          mode="aspectFill"
        />
        <view class="online-status" wx:if="{{item.isOnline}}"></view>
      </view>
      
      <view class="chat-content">
        <view class="chat-header">
          <view class="chat-name">{{item.name}}</view>
          <view class="chat-time">{{item.lastTime}}</view>
        </view>
        
        <view class="chat-message">
          <view class="message-preview">{{item.lastMessage}}</view>
          <view class="message-badge" wx:if="{{item.unreadCount > 0}}">
            <text class="badge">{{item.unreadCount > 99 ? '99+' : item.unreadCount}}</text>
          </view>
        </view>
        
        <view class="chat-meta">
          <view class="chat-company">{{item.company}}</view>
          <view class="chat-position">{{item.position}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-container" wx:if="{{chatList.length === 0 && !loading}}">
    <view class="empty-icon">💬</view>
    <view class="empty-text">暂无聊天记录</view>
    <view class="empty-desc">投递简历后即可与HR进行沟通</view>
    <button class="btn btn-primary" bindtap="navigateToJobs">去投递简历</button>
  </view>

  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-text">加载中...</view>
  </view>

  <!-- 快速操作 -->
  <view class="quick-actions" wx:if="{{chatList.length > 0}}">
    <view class="action-item" bindtap="showFilterModal">
      <view class="action-icon">🔍</view>
      <text class="action-text">筛选</text>
    </view>
    <view class="action-item" bindtap="markAllRead">
      <view class="action-icon">✓</view>
      <text class="action-text">全部已读</text>
    </view>
    <view class="action-item" bindtap="clearHistory">
      <view class="action-icon">🗑️</view>
      <text class="action-text">清空记录</text>
    </view>
  </view>
</view>

<!-- 筛选弹窗 -->
<view class="filter-modal" wx:if="{{showFilter}}" bindtap="hideFilterModal">
  <view class="filter-content" catchtap="stopPropagation">
    <view class="filter-header">
      <text class="filter-title">筛选聊天</text>
      <view class="filter-close" bindtap="hideFilterModal">✕</view>
    </view>
    
    <view class="filter-options">
      <view class="filter-option">
        <text class="option-label">未读消息</text>
        <switch checked="{{filter.unread}}" bindchange="toggleUnreadFilter" />
      </view>
      
      <view class="filter-option">
        <text class="option-label">在线状态</text>
        <switch checked="{{filter.online}}" bindchange="toggleOnlineFilter" />
      </view>
      
      <view class="filter-option">
        <text class="option-label">最近活跃</text>
        <picker 
          mode="selector" 
          range="{{timeOptions}}" 
          value="{{filter.timeIndex}}"
          bindchange="onTimeFilterChange"
        >
          <view class="picker-value">{{timeOptions[filter.timeIndex]}}</view>
        </picker>
      </view>
    </view>
    
    <view class="filter-actions">
      <button class="btn btn-secondary" bindtap="resetFilter">重置</button>
      <button class="btn btn-primary" bindtap="applyFilter">确定</button>
    </view>
  </view>
</view>
